<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Casinito ‚Äî Nivel 5 (Interfaz PRO)</title>
<meta name="description" content="Casinito nivel PRO: luces, animaciones, part√≠culas, confetti y microinteracciones. Sonidos en la ra√≠z: spin.wav, win.wav, lose.wav" />
<style>
  :root{
    --bg1:#090204; --bg2:#1b0000; --panel:#140505; --gold:#d4af37; --accent:#c60000; --muted:#e6d9cf;
    --glass:rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box} html,body{height:100%} body{margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:
    radial-gradient(circle at 10% 10%, rgba(198,0,0,0.05), transparent 12%),
    linear-gradient(180deg,var(--bg1),#000);color:var(--muted);padding:16px;display:flex;justify-content:center;align-items:flex-start}
  .wrap{width:min(1200px,96%);display:grid;grid-template-columns:1fr 380px;gap:16px;align-items:start}

  header{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border-radius:12px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent)}
  h1{margin:0;color:var(--gold);letter-spacing:1px;font-weight:800;text-shadow:0 6px 24px rgba(198,0,0,0.08)}
  .balance{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:8px 14px;border-radius:12px;display:inline-flex;gap:10px;align-items:center;position:relative;overflow:visible}
  .balance .glow{position:absolute;left:-40%;right:-40%;top:-20%;bottom:-20%;background:radial-gradient(circle at 50% 30%, rgba(212,159,55,0.08), transparent 30%);filter:blur(18px);z-index:-1;animation:glowPulse 3.6s ease-in-out infinite}

  @keyframes glowPulse{0%{opacity:.6;transform:scale(.98)}50%{opacity:1;transform:scale(1.02)}100%{opacity:.6;transform:scale(.98)}}

  /* marquee lights */
  .marquee{height:12px;border-radius:999px;background:linear-gradient(90deg,transparent 0, rgba(212,159,55,0.08) 20%, transparent 40%);position:relative;overflow:hidden;margin-top:8px}
  .marquee::before{content:'';position:absolute;left:-40%;top:0;bottom:0;width:40%;background:linear-gradient(90deg,rgba(214,159,55,0.9),rgba(255,210,120,0.6));filter:blur(6px);animation:marquee 2.6s linear infinite}
  @keyframes marquee{0%{left:-40%}100%{left:120%}}

  /* cards + effects */
  .card{background:linear-gradient(180deg,var(--panel),#0b0606);border-radius:12px;padding:14px;box-shadow:0 20px 60px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03);position:relative;overflow:visible}
  .card .title{display:flex;align-items:center;justify-content:space-between}

  /* reels */
  .reels{display:flex;gap:12px;justify-content:center;align-items:center;margin-top:12px}
  .reel{width:100px;height:100px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.06));display:flex;align-items:center;justify-content:center;font-size:46px;font-weight:900;position:relative;transform-origin:center;box-shadow:inset 0 -6px 18px rgba(0,0,0,0.45)}
  .reel.spinAnim{animation:reelSpin .6s cubic-bezier(.16,.9,.32,1)}
  @keyframes reelSpin{0%{transform:translateY(-30px) rotateX(20deg) scale(.95);opacity:0}50%{transform:translateY(8px) rotateX(-6deg) scale(1.02)}100%{transform:translateY(0) rotateX(0) scale(1);opacity:1}}

  /* buttons with ripple */
  .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  button{background:linear-gradient(90deg,var(--accent),#ff9b4c);border:none;color:#080508;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer;position:relative;overflow:hidden;box-shadow:0 10px 28px rgba(198,0,0,0.12);transition:transform .12s,box-shadow .12s}
  button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted)}
  button:active{transform:translateY(1px)}
  button .ripple{position:absolute;border-radius:999px;transform:scale(0);opacity:.6;background:rgba(255,255,255,0.18);pointer-events:none}

  /* rocket trail */
  .space-visual{height:130px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
  .trail{position:absolute;bottom:22px;width:8px;background:linear-gradient(180deg,var(--gold),transparent);height:0;border-radius:8px;opacity:0.95;transition:height .12s linear}

  /* confetti canvas */
  #confetti{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:9999}

  /* small text */
  .tiny{font-size:13px;color:var(--muted)}

  /* responsive */
  @media (max-width:980px){ .wrap{grid-template-columns:1fr} aside{order:2} .reel{width:78px;height:78px;font-size:36px} }
</style>
</head>
<body>
<canvas id="confetti"></canvas>

<div class="wrap">
  <header>
    <div>
      <h1>üé∞ Casinito ‚Äî Interfaz PRO</h1>
      <div class="marquee" aria-hidden="true"></div>
    </div>
    <div class="balance" id="balanceBox">
      <div class="glow"></div>
      Saldo: <strong style="margin-left:8px">$<span id="saldo">1000</span></strong>
    </div>
  </header>

  <main>
    <section class="card" id="slotsCard">
      <div class="title"><strong>Tragamonedas ‚Äî Deluxe</strong><div class="tiny">Apuesta: $<span id="bet">50</span></div></div>
      <div class="reels" id="reels">
        <div class="reel" id="r1">‚ùî</div>
        <div class="reel" id="r2">‚ùî</div>
        <div class="reel" id="r3">‚ùî</div>
      </div>

      <div class="controls" style="margin-top:12px">
        <button id="spinBtn">Girar</button>
        <button class="secondary" id="autoBtn">Auto x5</button>
        <button class="secondary" id="fastBtn">Spin R√°pido</button>
      </div>

      <div id="slotMsg" class="tiny" style="margin-top:12px">‚Äî</div>
      <div style="height:8px"></div>
    </section>

    <section class="card" style="margin-top:12px">
      <div class="title"><strong>Spaceman PRO (mini)</strong><div class="tiny">Retir√° antes de explotar</div></div>
      <div class="space-visual" style="margin-top:12px">
        <div class="trail" id="trail"></div>
        <div id="rocket" style="font-size:40px">üöÄ</div>
      </div>
      <div class="controls" style="margin-top:12px">
        <button id="startSpace">Iniciar</button>
        <button class="secondary" id="cashSpace">Retirar</button>
      </div>
      <div id="spaceMsg" class="tiny" style="margin-top:10px">x1.00</div>
    </section>
  </main>

  <aside>
    <div class="card">
      <div class="title"><strong>Controles & Sounds</strong><div class="tiny">Sonidos en ra√≠z: spin.wav win.wav lose.wav</div></div>
      <div style="margin-top:10px" class="controls">
        <button id="muteBtn" class="secondary">Mute</button>
        <button id="downloadBtn" class="secondary">Descargar ZIP</button>
      </div>
      <div style="margin-top:12px" class="tiny">Historial</div>
      <div id="history" style="margin-top:8px;max-height:300px;overflow:auto" class="tiny">‚Äî</div>
    </div>
  </aside>
</div>

<script>
/* ---------- State ---------- */
let state = { saldo:1000, bet:50, history:[] };
const saldoEl = document.getElementById('saldo');
const historyEl = document.getElementById('history');
const r1 = document.getElementById('r1'), r2 = document.getElementById('r2'), r3 = document.getElementById('r3');
const spinBtn = document.getElementById('spinBtn'), autoBtn=document.getElementById('autoBtn'), fastBtn=document.getElementById('fastBtn');
const trail = document.getElementById('trail'), rocket = document.getElementById('rocket'), spaceMsg = document.getElementById('spaceMsg');
const muteBtn = document.getElementById('muteBtn');
let audioCtx = null, masterGain = null;
let soundBuffers = { spin:null, win:null, lose:null };
let soundOn = true;

/* ---------- Audio setup (AudioContext) ---------- */
function initAudio(){
  if(audioCtx) return;
  try{
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    masterGain = audioCtx.createGain();
    masterGain.gain.value = 1;
    masterGain.connect(audioCtx.destination);
  }catch(e){ audioCtx = null; }
}
function playFallback(type){
  if(!audioCtx) return;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  if(type==='win'){ o.frequency.value=1100; o.type='sawtooth'; g.gain.value=0.08; }
  else if(type==='lose'){ o.frequency.value=180; o.type='sine'; g.gain.value=0.08; }
  else { o.frequency.value=700; o.type='square'; g.gain.value=0.06; }
  o.connect(g); g.connect(masterGain); o.start(); g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.18);
  setTimeout(()=>o.stop(),240);
}

/* Try to load root sounds (spin.wav, win.wav, lose.wav) into buffers (silent if missing) */
async function tryLoadSamples(){
  initAudio();
  if(!audioCtx) return;
  const keys = ['spin','win','lose'];
  for(const k of keys){
    try{
      const r = await fetch(`./${k}.wav`);
      if(!r.ok) { soundBuffers[k]=null; continue; }
      const arr = await r.arrayBuffer();
      const buf = await audioCtx.decodeAudioData(arr);
      soundBuffers[k]=buf;
    }catch(e){ soundBuffers[k]=null; }
  }
}
function playBuffer(buf,vol=1){
  if(!audioCtx || !buf || !soundOn) return playFallback('spin');
  const s = audioCtx.createBufferSource(); const g = audioCtx.createGain();
  s.buffer = buf; g.gain.value = vol; s.connect(g); g.connect(masterGain); s.start(0);
}

/* ---------- Utils ---------- */
function pushHistory(entry){
  entry.time = new Date().toLocaleTimeString();
  state.history.unshift(entry); if(state.history.length>200) state.history.pop();
  renderHistory();
}
function renderHistory(){ historyEl.innerHTML = state.history.map(h=>`<div>${h.time} ‚Äî ${h.type}: ${h.msg} ‚Ä¢ $${h.saldoAfter}</div>`).join(''); }
function updateSaldo(){ saldoEl.textContent = state.saldo; document.getElementById('balanceBox')?.classList.add('pulse'); setTimeout(()=>document.getElementById('balanceBox')?.classList.remove('pulse'),300); }

/* ---------- Confetti (improved) ---------- */
const conf = document.getElementById('confetti'); const cctx = conf.getContext && conf.getContext('2d');
let parts = [];
function spawnConfetti(x,y,n=80){
  if(!cctx) return;
  const mobile = window.innerWidth<700; const count = mobile?Math.floor(n/3):n;
  for(let i=0;i<count;i++){
    parts.push({x:x+(Math.random()*200-100), y:y+(Math.random()*30-15), vx:(Math.random()*14-7), vy:(Math.random()*-18-6), size:2+Math.random()*8, color:['#c60000','#ffd166','#d4af37'][Math.floor(Math.random()*3)], rot:Math.random()*360, life:0, ttl:100+Math.random()*160});
  }
}
function animateConfetti(){
  if(!cctx) return; cctx.clearRect(0,0,conf.width,conf.height);
  for(let i=parts.length-1;i>=0;i--){
    const p = parts[i]; p.vy += 0.45; p.x += p.vx; p.y += p.vy; p.vx *= 0.995; p.rot += 5;
    cctx.save(); cctx.translate(p.x,p.y); cctx.rotate(p.rot*Math.PI/180); cctx.fillStyle = p.color; cctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*1.6); cctx.restore();
    p.life++; if(p.y>conf.height+80 || p.life>p.ttl) parts.splice(i,1);
  }
  requestAnimationFrame(animateConfetti);
}
conf.width = window.innerWidth; conf.height = window.innerHeight; animateConfetti(); window.addEventListener('resize',()=>{ conf.width = window.innerWidth; conf.height = window.innerHeight; });

/* ---------- Slots logic (with animations) ---------- */
const icons = ['üçí','üçã','üîî','‚≠ê','7Ô∏è‚É£','üíé','üçÄ','üî•','üé≤'];
function spinOnce(){
  if(state.saldo < state.bet){ alert('No ten√©s saldo'); return; }
  initAudio(); tryLoadSamples();
  state.saldo -= state.bet; updateSaldo();
  // spin anim
  [r1,r2,r3].forEach(el=>{ el.classList.remove('spinAnim'); void el.offsetWidth; el.classList.add('spinAnim'); });
  const out1 = icons[Math.floor(Math.random()*icons.length)];
  const out2 = icons[Math.floor(Math.random()*icons.length)];
  const out3 = icons[Math.floor(Math.random()*icons.length)];
  // play spin sound
  if(soundBuffers.spin) playBuffer(soundBuffers.spin,0.6); else playFallback('spin');
  setTimeout(()=>{
    r1.textContent = out1; r2.textContent = out2; r3.textContent = out3;
    let msg = `Apostaste $${state.bet}`;
    if(out1===out2 && out2===out3){
      state.saldo += 500;
      msg += ` ‚Äî JACKPOT! Ganaste $500`;
      spawnConfetti(window.innerWidth/2,120,140);
      if(soundBuffers.win) playBuffer(soundBuffers.win,1); else playFallback('win');
    } else {
      msg += ' ‚Äî Perdiste';
      if(soundBuffers.lose) playBuffer(soundBuffers.lose,0.9); else playFallback('lose');
    }
    pushHistory({type:'SLOTS', msg, saldoAfter: state.saldo});
    updateSaldo(); document.getElementById('slotMsg').textContent = msg;
  },620);
}
spinBtn.addEventListener('click', ()=>{ if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); spinOnce(); });
autoBtn.addEventListener('click', async ()=>{ for(let i=0;i<5;i++){ if(state.saldo < state.bet) break; spinOnce(); await new Promise(r=>setTimeout(r,900)); } });
fastBtn.addEventListener('click', ()=>{ spinOnce(); });

/* ---------- Spaceman PRO (mini) ---------- */
let spaceTimer = null, spaceMult = 1, spacePlaying=false;
document.getElementById('startSpace').addEventListener('click', ()=>{
  if(spacePlaying) return; if(state.saldo < state.bet){ alert('Saldo insuficiente'); return; }
  initAudio(); tryLoadSamples();
  state.saldo -= state.bet; updateSaldo(); spacePlaying=true; spaceMult=1; spaceMsg.textContent='x1.00';
  rocket.style.transform = 'translateY(0)'; trail.style.height = '6px';
  let t=0;
  spaceTimer = setInterval(()=>{
    t++; spaceMult += 0.03 + Math.random()*0.06;
    rocket.style.transform = `translateY(-${Math.min(160, Math.pow(1.18,t)*6)}px)`;
    trail.style.height = `${Math.min(160, spaceMult*8)}px`;
    spaceMsg.textContent = 'x' + spaceMult.toFixed(2);
    const chance = Math.min(0.9, 0.02 + t*0.02);
    if(Math.random() < chance){
      clearInterval(spaceTimer); spacePlaying=false; spaceMsg.textContent='üí• EXPLOT√ì';
      spawnConfetti(window.innerWidth/2, window.innerHeight/3, 180); navigator.vibrate && navigator.vibrate([120,60,120]);
      pushHistory({type:'SPACEMAN', msg:'EXPLOT√ì', saldoAfter: state.saldo});
    }
  },110);
});
document.getElementById('cashSpace').addEventListener('click', ()=>{
  if(!spacePlaying) return; clearInterval(spaceTimer); spacePlaying=false; const gain = Math.floor(state.bet * spaceMult); state.saldo += gain; updateSaldo(); spaceMsg.textContent = `Retiraste $${gain}`; spawnConfetti(window.innerWidth/2, window.innerHeight/3, 200); navigator.vibrate && navigator.vibrate([30,20,30]); pushHistory({type:'SPACEMAN', msg:`Retir√≥ x${spaceMult.toFixed(2)} -> $${gain}`, saldoAfter: state.saldo});
});

/* ---------- Ripple effect on buttons ---------- */
document.querySelectorAll('button').forEach(btn=>{
  btn.addEventListener('pointerdown', e=>{
    const rect = btn.getBoundingClientRect();
    const ripple = document.createElement('div'); ripple.className='ripple';
    const size = Math.max(rect.width, rect.height)*1.2; ripple.style.width = ripple.style.height = size+'px';
    ripple.style.left = (e.clientX - rect.left - size/2) + 'px';
    ripple.style.top = (e.clientY - rect.top - size/2) + 'px';
    btn.appendChild(ripple);
    setTimeout(()=>{ ripple.style.transform='scale(1)'; ripple.style.opacity='0'; ripple.remove(); }, 500);
  });
});

/* ---------- Mute toggle ---------- */
muteBtn.addEventListener('click', ()=>{ soundOn = !soundOn; muteBtn.textContent = soundOn ? 'Mute' : 'Unmute'; if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); });

/* ---------- Download helper (link to packaged zip if available) ---------- */
document.getElementById('downloadBtn').addEventListener('click', ()=>{
  const link = document.createElement('a'); link.href = './casinito_lv_package.zip'; link.download = 'casinito_lv_package.zip'; document.body.appendChild(link); link.click(); document.body.removeChild(link);
});

/* ---------- init ---------- */
updateSaldo(); renderHistory();
tryLoadSamples();
</script>
</body>
</html>
